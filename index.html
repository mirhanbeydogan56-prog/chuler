<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>schulunterhaltung.space </title>

<style>
body {
  margin: 0;
  font-family: Inter, Arial, sans-serif;
  background: #f6f7fb;
  color: #222;
}
#adminBtn {
  position: fixed;
  bottom: 20px;
  right: 20px;
  background: #6c63ff;
  color: #fff;
  border: none;
  padding: 12px 18px;
  border-radius: 30px;
  cursor: pointer;
}
#adminPanel {
  display: none;
  padding: 30px;
}
input, button {
  padding: 12px;
  border-radius: 10px;
  border: 1px solid #ddd;
  margin: 6px 0;
}
.card {
  background: #fff;
  border-radius: 16px;
  padding: 15px;
  margin: 12px 0;
  box-shadow: 0 8px 20px rgba(0,0,0,0.06);
}
</style>
</head>

<body>

<!-- NORMALE BENUTZER: LEER -->
<div></div>

<button id="adminBtn" onclick="openAdmin()">Admin</button>

<div id="adminPanel">
  <h2>ğŸ” Admin-Anmeldung</h2>
  <input type="password" id="pass" placeholder="Passwort">
  <br>
  <button onclick="login()">Anmelden</button>

  <div id="panel" style="display:none;">
    <h1>ğŸ“Š Gesamtteilnehmer: <span id="count">0</span></h1>
    <div id="list"></div>
  </div>
</div>

<!-- FIREBASE v9 -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getDatabase, ref, runTransaction, onValue } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";
import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-analytics.js";

// ğŸ”¥ DEINE FIREBASE KONFIGURATION
const firebaseConfig = {
  apiKey: "AIzaSyBpuVs9M1vUhR9OXahdm4vhpZMrKl9KuGI",
  authDomain: "ertee-fc073.firebaseapp.com",
  databaseURL: "https://ertee-fc073-default-rtdb.firebaseio.com",
  projectId: "ertee-fc073",
  storageBucket: "ertee-fc073.firebasestorage.app",
  messagingSenderId: "738703331926",
  appId: "1:738703331926:web:fcb8aaf5b54b9a884c21f7",
  measurementId: "G-C5L6NY2TDK"
};

const app = initializeApp(firebaseConfig);
getAnalytics(app);
const db = getDatabase(app);

const ADMIN_PASS = "admin123";

function timeFormat(t) {
  return new Date(t).toLocaleString("de-DE");
}

// ğŸŒ IP + STANDORT + NUR 1Ã— ZÃ„HLEN
fetch("https://api.ipify.org?format=json")
.then(r => r.json())
.then(ipData => {
  const ip = ipData.ip;
  const safeIP = ip.replace(/\./g, "_");

  fetch(`https://ipapi.co/${ip}/json/`)
  .then(r => r.json())
  .then(loc => {
    const userRef = ref(db, "users/" + safeIP);

    runTransaction(userRef, current => {
      if (current === null) {
        return {
          ip: ip,
          country: loc.country_name || "Unbekannt",
          city: loc.city || "Unbekannt",
          device: navigator.userAgent,
          screen: screen.width + "x" + screen.height,
          firstSeen: Date.now(),
          lastSeen: Date.now()
        };
      } else {
        current.lastSeen = Date.now();
        return current;
      }
    });
  });
});

// ğŸ” ADMIN FUNKTIONEN
window.openAdmin = function () {
  document.getElementById("adminPanel").style.display = "block";
};

window.login = function () {
  if (document.getElementById("pass").value === ADMIN_PASS) {
    document.getElementById("panel").style.display = "block";

    onValue(ref(db, "users"), snap => {
      const data = snap.val() || {};
      document.getElementById("count").innerText = Object.keys(data).length;

      const list = document.getElementById("list");
      list.innerHTML = "";

      Object.values(data).forEach(u => {
        list.innerHTML += `
          <div class="card">
            ğŸŒ <b>IP-Adresse:</b> ${u.ip}<br>
            ğŸŒ <b>Standort:</b> ${u.city}, ${u.country}<br>
            ğŸ“± <b>GerÃ¤t:</b> ${u.device}<br>
            ğŸ–¥ï¸ <b>Bildschirm:</b> ${u.screen}<br>
            ğŸ•’ <b>Erster Besuch:</b> ${timeFormat(u.firstSeen)}<br>
            â±ï¸ <b>Letzter Besuch:</b> ${timeFormat(u.lastSeen)}
          </div>
        `;
      });
    });

  } else {
    alert("Falsches Passwort");
  }
};
</script>

</body>
</html>

